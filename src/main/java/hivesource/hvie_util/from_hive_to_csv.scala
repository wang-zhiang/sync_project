package hivesource.hvie_util




import org.apache.hadoop.conf.Configuration
import org.apache.hadoop.fs.Path
import org.apache.spark.sql.{SaveMode, SparkSession}

object from_hive_to_csv {

  def main(args: Array[String]): Unit = {
    System.setProperty("log4j.configuration", "D:\\wzza\\develop\\idea_project\\ceshi\\src\\main\\resources\\log4j2.xml")
    // 创建 Hadoop Configuration
    val hadoopConf = new Configuration()
    hadoopConf.addResource(new Path("D:\\wzza\\develop\\idea_project\\ceshi\\src\\main\\resources\\core-site.xml"))
    hadoopConf.addResource(new Path("D:\\wzza\\develop\\idea_project\\ceshi\\src\\main\\resources\\hdfs-site.xml"))
    hadoopConf.addResource(new Path("D:\\wzza\\develop\\idea_project\\ceshi\\src\\main\\resources\\yarn-site.xml"))
    hadoopConf.addResource(new Path("D:\\wzza\\develop\\idea_project\\ceshi\\src\\main\\resources\\hive-site.xml"))
    hadoopConf.addResource(new Path("D:\\wzza\\develop\\idea_project\\ceshi\\src\\main\\resources\\spark-defaults.xml"))


    // 创建 SparkSession
    var spark = SparkSession.builder()
      .appName("Hive Access")
      //.config("spark.sql.warehouse.dir", "/user/hive/warehouse/dwd")
      .master("local[*]")
      .enableHiveSupport()
      .getOrCreate()

    // 应用 Hadoop 配置


    spark.sparkContext.hadoopConfiguration.addResource(hadoopConf)

    // 定义 SQL 查询语句
    // 请根据你的实际情况修改此查询语句
    val sqlQuery = "select * from ods.elm where pt_ym = '202212' and id in ('2452','2567','2571','2736','2809','2822','2833','2922','2981','3017','3467','3470','3481','3487','3488','3489','3508','3509','3510','3678','3692','3705','3706','3717','3719','3750','3756','3772','3804','3823','3874','3879','3932','4007','4029','4043','4044','4045','4049','4050','4059','4062','4171','4204','4589','9571','32398','32465','43921','44206','45329','48528','68206','68228','68250','68278','68283','68299','68340','68370','68382','68403','68429','68452','68455','68460','68462','68463','68473','68485','68512','68520','68524','68526','68527','68531','68537','68546','68556','68563','68566','68572','68589','68599','68613','68616','68661','68666','68680','68719','68893','68908','68956','68967','68979','69006','69072','69084','69126','69147','69158','69166','69172','69181','69205','69207','69212','69220','69223','69229','69239','69258','69261','69262','69278','69354','69360','69499','69527','69537','69545','69600','69618','69627','69634','69638','69646','69680','69692','69704','69713','69714','69718','69723','69726','69761','69766','69770','69789','69837','69858','69872','77396','77745','78405','79044','79250','79314','79316','79323','79333','80023','101548','101556','101773','101862','102021','102046','102047','114959','115309','115490','116319','116374','125139','150202','150223','150226','156643','208960','209035','209070','209331','210160','216106','216500','217996','219825','220242','262282','262499','262610','262617','262664','262667','262684','262686','262697','262698','263250','278177','278281','278291','278301','278317','278381','278389','278415','278444','278482','278547','278557','278567','278574','278575','278579','278588','279101','279348','280415','320867','320908','320915','321508','371600','373745','373747','373768','373770','373771','373777','373886','374027','374133','374202','374210','374217','374313','374542','374547','374561','374636','374747','374751','374856','374870','374919','380359','380486','388165','388167','388301','428873','428903','429222','429367','429378','430139','430148','430149','430165','430166','430169','430170','430171','430204','430206','430222','430238','430241','430242','430243','430244','430245','430248','430257','430277','430413','430848','431304','431360','431546','431550','433361','433501','433609','433914','433920','433922','433971','433973','433974','433980','433982','433986','434039','434059','436268','436717','437957','442543','443830','444263','444269','447411','447423','449509','453655','454372','454675','454898','455614','455695','455900','456639','456832','456876','457806','457852','457867','457970','458041','458052','458438','458460','458533','458816','458829','459062','459074','459349','459432','491568','491617','526900','532368','532436','532610','532611','532614','532620','532624','532628','532632','532655','532666','532703','532707','532709','532714','532719','532720','532724','532748','532800','533026','533041','533042','533043','533052','533053','533069','533073','533090','533166','533227','533275','533300','533330','533338','533454','533457','533463','533504','533507','533508','533532','533688','533730','533739','533806','533981','534054','534133','534199','534323','534395','534501','534576','534965','535105','535137','535249','535577','535655','535659','535783','535796','535824','535828','535856','535895','535979','535985','562501','562508','592312','615387','625479','649266','649312','649359','649524','649541','649568','649570','649584','649589','649590','649611','649891','649903','649952','650003','650023','650107','650190','650303','650708','650936','651039','651045','651046','651055','651097','651098','651100','651150','651162','651172','651212','657109','661827','685633','686533','686553','686574','747250','747255','747451','747468','760780','760908','770503','770653','787514','787555','787676','787684','787696','787700','787755','789455','813003','813338','823287','823328','824336','824870','825094','825511','825768','827505','862874','880518','880561','880620','880856','880883','881136','881150','881232','881458','881724','882049','882093','882139','882167','882311','882374','882382','882385','882925','882927','882944','882947','882955','883064','884014','885309','885381','885512','885780','885878','885887','886027','886055','886143','886155','886157','886171','886181','886186','886190','886193','886205','886209','886211','886251','886319','886320','886390','886410','886605','886654','886668','886670','886680','886717','886724','887322','887336','887388','887422','887438','887529','887736','887869','887881','888130','888172','888211','888245','888250','888251','888392','888442','888523','927461','927469','927898','1001124','1008026','1008107','1078976','1123362','1124610','1269992','1307509','1307688','1308385','1382834','1690468','1703621','1703881','1703979','1704035','1704220','1704368','1704452','1704460','1704512','1705162','1705222','1705593','1706587','1706683','1706701','1707778','1707783','1707793','1707886','1707910','1707986','1707989','1707994','1708005','1708053','1708054','1708151','1708154','1708170','1708176','1708177','1708259','1708263','1708318','1708378','1708408','1708419','1708484','1708493','1708497','1708705','1708746','1708794','1709196','1709393','1709504','1709641','1709648','1709719','1709788','1710153','1710218','1710285','1710295','1710316','1710454','1710525','1723621','1723628','1724491','1724809','1725927','1726019','1726255','1726264','1726335','1726375','1726382','1726434','1726456','1726491','1726598','1727111','1730155','1730553','1731122','1731735','1743001','1745749','1748875','1749097','1774206','1774435','1774642','1774778','1775551','1775754','1775866','1776175','1776180','1776477','1776485','1776565','1776963','1776999','1777101','1798612','1798643','1798648','1799154','1799188','1799879','1800070','1800544','1800574','1816209','1819758','1866955','1866958','1866963','1866971','1866974','1866982','1866988','1867001','1867007','1867008','1867013','1867017','1867054','1867263','1867342','1867387','1867392','1867586','1867615','1867618','1867627','1867812','1867822','1867858','1867920','1867921','1867922','1867925','1867928','1867929','1867937','1867945','1867948','1867956','1868046','1868047','1868048','1868061','1868066','1868072','1868140','1868145','1868149','1868167','1868251','1868252','1868259','1868274','1868315','1868316','1868340','1868374','1868407','1868454','1868551','1868556','1868621','1868623','1868663','1868669','1868679','1868686','1868711','1868786','1868793','1868833','1868874','1868875','1868876','1869043','1869063','1869066','1869073','1869150','1869179','1869261','1869269','1869288','1869389','1869505','1869556','1869593','1878476','1878477','1878478','1878485','1878494','1889548','1889573','1889875','1890061','1890094','1890147','1890336','1890365','1890374','1890395','1890625','1890975','1891240','1891294','1891310','1891321','1891345','1891971','1891986','1892001','1892048','1892120','1892174','1892199','1895084','1895482','1895549','1895579','1912714','1912726','1913527','1913976','1918669','1918699','1918713','1918716','1918723','1918739','1918941','1919204','1919211','1919276','1919305','1919426','1919449','1919455','1919480','1919546','1919564','1919601','1919621','1919655','1919656','1919658','1919670','1919685','1919696','1919746','1919753','1919755','1919759','1919762','1919766','1919770','1919782','1919784','1919786','1919886','1919892','1919894','1919918','1919970','1919992','1920051','1920226','1920229','1920236','1920240','1920345','1920391','1920395','1920403','1920407','1920421','1920425','1920436','1920448','1920494','1920549','1920607','1920616','1920939','1920942','1921011','1921084','1921099','1921125','1921170','1921175','1921176','1921181','1921187','1921189','1921191','1921205','1921208','1921905','1922079','1922091','1922113','1922185','1922193','1922248','1922277','1922279','1922403','1922423','1922474','1922514','1922523','1922534','1922660','1922683','1922751','1922761','1923089','1923109','1923245','1923312','1923468','1923478','1923556','1924114','1924129','1924252','1924253','1924365','1925468','1925471','1925474','1925487','1925488','1925495','1925501','1925527','1925528','1925539','1925668','1925705','1925735','1925814','1925829','1925899','1925949','1925958','1925967','1926032','1926066','1926073','1926137','1926180','1926490','1926493','1926495','1926498','1926512','1926524','1926652','1926679','1926788','1926858','1926924','1927046','1927047','1927121','1927134','1927140','1927158','1927177','1927181','1927217','1927227','1927249','1927297','1927301','1927304','1927330','1927346','1927358','1927363','1927367','1927375','1927382','1927386','1927389','1927492','1927494','1927528','1927548','1927557','1927647','1927736','1927784','1927823','1927838','1927928','1927975','1927978','1927980','1927981','1928003','1928011','1928018','1928044','1928075','1928077','1928158','1928167','1928199','1928238','1928244','1928495','1953091','1954115','1954929','1955278','1955550','1976517','1978091','1978761','1978774','1978826','1996703','2004012','2004042','2005062','2005224','2005240','2005807','2005814','2006783','2014830','2015635','2015959','2028815','2028839','2028860','2032772','2034784','2039097','2039145','2039147','2039148') order by id"

    // 执行 SQL 查询
    val df = spark.sql(sqlQuery)

    // 显示查询结果的前几行，以验证结果
    df.show()

    // 定义输出路径
    // 请根据你的项目结构修改此路径
    val outputCsvPath = "D:\\wzza\\develop\\idea_project\\ceshi\\src\\main\\java\\hivesource\\hvie_util\\result.csv"

    // 将查询结果保存为 CSV 文件
    df.write
      .mode(SaveMode.Overwrite) // 如果文件已存在，则覆盖
      .option("header", "true") // 在CSV文件中包含列名作为头部
      .csv(outputCsvPath)

    // 停止 SparkSession
    spark.stop()

    println(s"结果已保存到: $outputCsvPath")
  }
}
